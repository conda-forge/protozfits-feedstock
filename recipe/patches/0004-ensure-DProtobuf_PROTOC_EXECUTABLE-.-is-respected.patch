From ce9d8723523fe22b87e3879993ec716c98905f20 Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Wed, 1 Nov 2023 21:35:54 +1100
Subject: [PATCH 4/4] ensure -DProtobuf_PROTOC_EXECUTABLE=... is respected

---
 CMakeLists.txt | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 4f839de..4802862 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -36,7 +36,15 @@ set(protobuf_MODULE_COMPATIBLE ON)
 # prefer finding Protobuf via cmake config, the modern approach
 find_package(Protobuf CONFIG)
 if(Protobuf_FOUND)
+    # if protobuf-config.cmake is used, we need to explicitly
+    # support the case in which we are cross-compiling and we want
+    # to explicitly specify via CMake command line the protoc to use
     message(STATUS "Found protobuf via cmake config")
+    if(Protobuf_PROTOC_EXECUTABLE)
+      set_target_properties(protobuf::protoc PROPERTIES
+        IMPORTED_LOCATION_RELEASE "${Protobuf_PROTOC_EXECUTABLE}"
+      )
+    endif()
 else()
     message(WARNING "Falling back to cmake FindProtobuf as Protobuf was not found via CONFIG")
     find_package(Protobuf REQUIRED)
